name: Deploy website thiennguyen.dev

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
    - uses: actions/checkout@v1
    - name: Create env file
      run: |
        touch .env
        echo GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }} >> .env
    - name: Run a multi-line script
      env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GH_PRIVATE_THEME_REPOSITORY: ${{ secrets.GH_PRIVATE_THEME_REPOSITORY }}
      run: |
        echo "GITHUB_TOKEN=${GITHUB_TOKEN}" >> $GITHUB_ENV
        git config --global user.email "${GITHUB_ACTOR}@users.noreply.github.com"
        git config --global user.name "github-actions"
        git config --global url."https://x-access-token:${GITHUB_TOKEN}@github.com/".insteadOf "git@github.com:"
        touch .env
        echo GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }} >> .env
        npm run myinstall && npm run build-gh-page
      
    - name: Deploy
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_branch: gh-pages
        enable_jekyll: false
